{"ast":null,"code":"import { AddEquation, Color, CustomBlending, DataTexture, DepthTexture, DstAlphaFactor, DstColorFactor, FloatType, MathUtils, MeshNormalMaterial, NearestFilter, NoBlending, RedFormat, LuminanceFormat, DepthStencilFormat, UnsignedInt248Type, RepeatWrapping, ShaderMaterial, UniformsUtils, Vector3, WebGLRenderTarget, ZeroFactor } from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { SimplexNoise } from '../math/SimplexNoise.js';\nimport { SSAOShader } from '../shaders/SSAOShader.js';\nimport { SSAOBlurShader } from '../shaders/SSAOShader.js';\nimport { SSAODepthShader } from '../shaders/SSAOShader.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\nclass SSAOPass extends Pass {\n  constructor(scene, camera, width, height) {\n    super();\n    this.width = width !== undefined ? width : 512;\n    this.height = height !== undefined ? height : 512;\n    this.clear = true;\n    this.camera = camera;\n    this.scene = scene;\n    this.kernelRadius = 8;\n    this.kernelSize = 32;\n    this.kernel = [];\n    this.noiseTexture = null;\n    this.output = 0;\n    this.minDistance = 0.005;\n    this.maxDistance = 0.1;\n    this._visibilityCache = new Map();\n\n    //\n\n    this.generateSampleKernel();\n    this.generateRandomKernelRotations();\n\n    // beauty render target\n\n    const depthTexture = new DepthTexture();\n    depthTexture.format = DepthStencilFormat;\n    depthTexture.type = UnsignedInt248Type;\n    this.beautyRenderTarget = new WebGLRenderTarget(this.width, this.height);\n\n    // normal render target with depth buffer\n\n    this.normalRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter,\n      depthTexture: depthTexture\n    });\n\n    // ssao render target\n\n    this.ssaoRenderTarget = new WebGLRenderTarget(this.width, this.height);\n    this.blurRenderTarget = this.ssaoRenderTarget.clone();\n\n    // ssao material\n\n    this.ssaoMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAOShader.defines),\n      uniforms: UniformsUtils.clone(SSAOShader.uniforms),\n      vertexShader: SSAOShader.vertexShader,\n      fragmentShader: SSAOShader.fragmentShader,\n      blending: NoBlending\n    });\n    this.ssaoMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n    this.ssaoMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture;\n    this.ssaoMaterial.uniforms['tDepth'].value = this.normalRenderTarget.depthTexture;\n    this.ssaoMaterial.uniforms['tNoise'].value = this.noiseTexture;\n    this.ssaoMaterial.uniforms['kernel'].value = this.kernel;\n    this.ssaoMaterial.uniforms['cameraNear'].value = this.camera.near;\n    this.ssaoMaterial.uniforms['cameraFar'].value = this.camera.far;\n    this.ssaoMaterial.uniforms['resolution'].value.set(this.width, this.height);\n    this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n\n    // normal material\n\n    this.normalMaterial = new MeshNormalMaterial();\n    this.normalMaterial.blending = NoBlending;\n\n    // blur material\n\n    this.blurMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAOBlurShader.defines),\n      uniforms: UniformsUtils.clone(SSAOBlurShader.uniforms),\n      vertexShader: SSAOBlurShader.vertexShader,\n      fragmentShader: SSAOBlurShader.fragmentShader\n    });\n    this.blurMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\n    this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height);\n\n    // material for rendering the depth\n\n    this.depthRenderMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAODepthShader.defines),\n      uniforms: UniformsUtils.clone(SSAODepthShader.uniforms),\n      vertexShader: SSAODepthShader.vertexShader,\n      fragmentShader: SSAODepthShader.fragmentShader,\n      blending: NoBlending\n    });\n    this.depthRenderMaterial.uniforms['tDepth'].value = this.normalRenderTarget.depthTexture;\n    this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\n    this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far;\n\n    // material for rendering the content of a render target\n\n    this.copyMaterial = new ShaderMaterial({\n      uniforms: UniformsUtils.clone(CopyShader.uniforms),\n      vertexShader: CopyShader.vertexShader,\n      fragmentShader: CopyShader.fragmentShader,\n      transparent: true,\n      depthTest: false,\n      depthWrite: false,\n      blendSrc: DstColorFactor,\n      blendDst: ZeroFactor,\n      blendEquation: AddEquation,\n      blendSrcAlpha: DstAlphaFactor,\n      blendDstAlpha: ZeroFactor,\n      blendEquationAlpha: AddEquation\n    });\n    this.fsQuad = new FullScreenQuad(null);\n    this.originalClearColor = new Color();\n  }\n  dispose() {\n    // dispose render targets\n\n    this.beautyRenderTarget.dispose();\n    this.normalRenderTarget.dispose();\n    this.ssaoRenderTarget.dispose();\n    this.blurRenderTarget.dispose();\n\n    // dispose materials\n\n    this.normalMaterial.dispose();\n    this.blurMaterial.dispose();\n    this.copyMaterial.dispose();\n    this.depthRenderMaterial.dispose();\n\n    // dipsose full screen quad\n\n    this.fsQuad.dispose();\n  }\n  render(renderer, writeBuffer /*, readBuffer, deltaTime, maskActive */) {\n    if (renderer.capabilities.isWebGL2 === false) this.noiseTexture.format = LuminanceFormat;\n\n    // render beauty\n\n    renderer.setRenderTarget(this.beautyRenderTarget);\n    renderer.clear();\n    renderer.render(this.scene, this.camera);\n\n    // render normals and depth (honor only meshes, points and lines do not contribute to SSAO)\n\n    this.overrideVisibility();\n    this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 0x7777ff, 1.0);\n    this.restoreVisibility();\n\n    // render SSAO\n\n    this.ssaoMaterial.uniforms['kernelRadius'].value = this.kernelRadius;\n    this.ssaoMaterial.uniforms['minDistance'].value = this.minDistance;\n    this.ssaoMaterial.uniforms['maxDistance'].value = this.maxDistance;\n    this.renderPass(renderer, this.ssaoMaterial, this.ssaoRenderTarget);\n\n    // render blur\n\n    this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget);\n\n    // output result to screen\n\n    switch (this.output) {\n      case SSAOPass.OUTPUT.SSAO:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSAOPass.OUTPUT.Blur:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSAOPass.OUTPUT.Beauty:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSAOPass.OUTPUT.Depth:\n        this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSAOPass.OUTPUT.Normal:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      case SSAOPass.OUTPUT.Default:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n        this.copyMaterial.blending = CustomBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n      default:\n        console.warn('THREE.SSAOPass: Unknown output type.');\n    }\n  }\n  renderPass(renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\n    // save original state\n    renderer.getClearColor(this.originalClearColor);\n    const originalClearAlpha = renderer.getClearAlpha();\n    const originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n\n    // setup pass state\n    renderer.autoClear = false;\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n    this.fsQuad.material = passMaterial;\n    this.fsQuad.render(renderer);\n\n    // restore original state\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  }\n  renderOverride(renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    renderer.getClearColor(this.originalClearColor);\n    const originalClearAlpha = renderer.getClearAlpha();\n    const originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n    this.scene.overrideMaterial = overrideMaterial;\n    renderer.render(this.scene, this.camera);\n    this.scene.overrideMaterial = null;\n\n    // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  }\n  setSize(width, height) {\n    this.width = width;\n    this.height = height;\n    this.beautyRenderTarget.setSize(width, height);\n    this.ssaoRenderTarget.setSize(width, height);\n    this.normalRenderTarget.setSize(width, height);\n    this.blurRenderTarget.setSize(width, height);\n    this.ssaoMaterial.uniforms['resolution'].value.set(width, height);\n    this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n    this.blurMaterial.uniforms['resolution'].value.set(width, height);\n  }\n  generateSampleKernel() {\n    const kernelSize = this.kernelSize;\n    const kernel = this.kernel;\n    for (let i = 0; i < kernelSize; i++) {\n      const sample = new Vector3();\n      sample.x = Math.random() * 2 - 1;\n      sample.y = Math.random() * 2 - 1;\n      sample.z = Math.random();\n      sample.normalize();\n      let scale = i / kernelSize;\n      scale = MathUtils.lerp(0.1, 1, scale * scale);\n      sample.multiplyScalar(scale);\n      kernel.push(sample);\n    }\n  }\n  generateRandomKernelRotations() {\n    const width = 4,\n      height = 4;\n    const simplex = new SimplexNoise();\n    const size = width * height;\n    const data = new Float32Array(size);\n    for (let i = 0; i < size; i++) {\n      const x = Math.random() * 2 - 1;\n      const y = Math.random() * 2 - 1;\n      const z = 0;\n      data[i] = simplex.noise3d(x, y, z);\n    }\n    this.noiseTexture = new DataTexture(data, width, height, RedFormat, FloatType);\n    this.noiseTexture.wrapS = RepeatWrapping;\n    this.noiseTexture.wrapT = RepeatWrapping;\n    this.noiseTexture.needsUpdate = true;\n  }\n  overrideVisibility() {\n    const scene = this.scene;\n    const cache = this._visibilityCache;\n    scene.traverse(function (object) {\n      cache.set(object, object.visible);\n      if (object.isPoints || object.isLine) object.visible = false;\n    });\n  }\n  restoreVisibility() {\n    const scene = this.scene;\n    const cache = this._visibilityCache;\n    scene.traverse(function (object) {\n      const visible = cache.get(object);\n      object.visible = visible;\n    });\n    cache.clear();\n  }\n}\nSSAOPass.OUTPUT = {\n  'Default': 0,\n  'SSAO': 1,\n  'Blur': 2,\n  'Beauty': 3,\n  'Depth': 4,\n  'Normal': 5\n};\nexport { SSAOPass };","map":{"version":3,"names":["AddEquation","Color","CustomBlending","DataTexture","DepthTexture","DstAlphaFactor","DstColorFactor","FloatType","MathUtils","MeshNormalMaterial","NearestFilter","NoBlending","RedFormat","LuminanceFormat","DepthStencilFormat","UnsignedInt248Type","RepeatWrapping","ShaderMaterial","UniformsUtils","Vector3","WebGLRenderTarget","ZeroFactor","Pass","FullScreenQuad","SimplexNoise","SSAOShader","SSAOBlurShader","SSAODepthShader","CopyShader","SSAOPass","constructor","scene","camera","width","height","undefined","clear","kernelRadius","kernelSize","kernel","noiseTexture","output","minDistance","maxDistance","_visibilityCache","Map","generateSampleKernel","generateRandomKernelRotations","depthTexture","format","type","beautyRenderTarget","normalRenderTarget","minFilter","magFilter","ssaoRenderTarget","blurRenderTarget","clone","ssaoMaterial","defines","Object","assign","uniforms","vertexShader","fragmentShader","blending","value","texture","near","far","set","copy","projectionMatrix","projectionMatrixInverse","normalMaterial","blurMaterial","depthRenderMaterial","copyMaterial","transparent","depthTest","depthWrite","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","fsQuad","originalClearColor","dispose","render","renderer","writeBuffer","capabilities","isWebGL2","setRenderTarget","overrideVisibility","renderOverride","restoreVisibility","renderPass","OUTPUT","SSAO","renderToScreen","Blur","Beauty","Depth","Normal","Default","console","warn","passMaterial","renderTarget","clearColor","clearAlpha","getClearColor","originalClearAlpha","getClearAlpha","originalAutoClear","autoClear","setClearColor","setClearAlpha","material","overrideMaterial","setSize","i","sample","x","Math","random","y","z","normalize","scale","lerp","multiplyScalar","push","simplex","size","data","Float32Array","noise3d","wrapS","wrapT","needsUpdate","cache","traverse","object","visible","isPoints","isLine","get"],"sources":["F:/Portfolio/3D-portfolio/node_modules/three/examples/jsm/postprocessing/SSAOPass.js"],"sourcesContent":["import {\r\n\tAddEquation,\r\n\tColor,\r\n\tCustomBlending,\r\n\tDataTexture,\r\n\tDepthTexture,\r\n\tDstAlphaFactor,\r\n\tDstColorFactor,\r\n\tFloatType,\r\n\tMathUtils,\r\n\tMeshNormalMaterial,\r\n\tNearestFilter,\r\n\tNoBlending,\r\n\tRedFormat,\r\n\tLuminanceFormat,\r\n\tDepthStencilFormat,\r\n\tUnsignedInt248Type,\r\n\tRepeatWrapping,\r\n\tShaderMaterial,\r\n\tUniformsUtils,\r\n\tVector3,\r\n\tWebGLRenderTarget,\r\n\tZeroFactor\r\n} from 'three';\r\nimport { Pass, FullScreenQuad } from './Pass.js';\r\nimport { SimplexNoise } from '../math/SimplexNoise.js';\r\nimport { SSAOShader } from '../shaders/SSAOShader.js';\r\nimport { SSAOBlurShader } from '../shaders/SSAOShader.js';\r\nimport { SSAODepthShader } from '../shaders/SSAOShader.js';\r\nimport { CopyShader } from '../shaders/CopyShader.js';\r\n\r\nclass SSAOPass extends Pass {\r\n\r\n\tconstructor( scene, camera, width, height ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.width = ( width !== undefined ) ? width : 512;\r\n\t\tthis.height = ( height !== undefined ) ? height : 512;\r\n\r\n\t\tthis.clear = true;\r\n\r\n\t\tthis.camera = camera;\r\n\t\tthis.scene = scene;\r\n\r\n\t\tthis.kernelRadius = 8;\r\n\t\tthis.kernelSize = 32;\r\n\t\tthis.kernel = [];\r\n\t\tthis.noiseTexture = null;\r\n\t\tthis.output = 0;\r\n\r\n\t\tthis.minDistance = 0.005;\r\n\t\tthis.maxDistance = 0.1;\r\n\r\n\t\tthis._visibilityCache = new Map();\r\n\r\n\t\t//\r\n\r\n\t\tthis.generateSampleKernel();\r\n\t\tthis.generateRandomKernelRotations();\r\n\r\n\t\t// beauty render target\r\n\r\n\t\tconst depthTexture = new DepthTexture();\r\n\t\tdepthTexture.format = DepthStencilFormat;\r\n\t\tdepthTexture.type = UnsignedInt248Type;\r\n\r\n\t\tthis.beautyRenderTarget = new WebGLRenderTarget( this.width, this.height );\r\n\r\n\t\t// normal render target with depth buffer\r\n\r\n\t\tthis.normalRenderTarget = new WebGLRenderTarget( this.width, this.height, {\r\n\t\t\tminFilter: NearestFilter,\r\n\t\t\tmagFilter: NearestFilter,\r\n\t\t\tdepthTexture: depthTexture\r\n\t\t} );\r\n\r\n\t\t// ssao render target\r\n\r\n\t\tthis.ssaoRenderTarget = new WebGLRenderTarget( this.width, this.height );\r\n\r\n\t\tthis.blurRenderTarget = this.ssaoRenderTarget.clone();\r\n\r\n\t\t// ssao material\r\n\r\n\t\tthis.ssaoMaterial = new ShaderMaterial( {\r\n\t\t\tdefines: Object.assign( {}, SSAOShader.defines ),\r\n\t\t\tuniforms: UniformsUtils.clone( SSAOShader.uniforms ),\r\n\t\t\tvertexShader: SSAOShader.vertexShader,\r\n\t\t\tfragmentShader: SSAOShader.fragmentShader,\r\n\t\t\tblending: NoBlending\r\n\t\t} );\r\n\r\n\t\tthis.ssaoMaterial.uniforms[ 'tDiffuse' ].value = this.beautyRenderTarget.texture;\r\n\t\tthis.ssaoMaterial.uniforms[ 'tNormal' ].value = this.normalRenderTarget.texture;\r\n\t\tthis.ssaoMaterial.uniforms[ 'tDepth' ].value = this.normalRenderTarget.depthTexture;\r\n\t\tthis.ssaoMaterial.uniforms[ 'tNoise' ].value = this.noiseTexture;\r\n\t\tthis.ssaoMaterial.uniforms[ 'kernel' ].value = this.kernel;\r\n\t\tthis.ssaoMaterial.uniforms[ 'cameraNear' ].value = this.camera.near;\r\n\t\tthis.ssaoMaterial.uniforms[ 'cameraFar' ].value = this.camera.far;\r\n\t\tthis.ssaoMaterial.uniforms[ 'resolution' ].value.set( this.width, this.height );\r\n\t\tthis.ssaoMaterial.uniforms[ 'cameraProjectionMatrix' ].value.copy( this.camera.projectionMatrix );\r\n\t\tthis.ssaoMaterial.uniforms[ 'cameraInverseProjectionMatrix' ].value.copy( this.camera.projectionMatrixInverse );\r\n\r\n\t\t// normal material\r\n\r\n\t\tthis.normalMaterial = new MeshNormalMaterial();\r\n\t\tthis.normalMaterial.blending = NoBlending;\r\n\r\n\t\t// blur material\r\n\r\n\t\tthis.blurMaterial = new ShaderMaterial( {\r\n\t\t\tdefines: Object.assign( {}, SSAOBlurShader.defines ),\r\n\t\t\tuniforms: UniformsUtils.clone( SSAOBlurShader.uniforms ),\r\n\t\t\tvertexShader: SSAOBlurShader.vertexShader,\r\n\t\t\tfragmentShader: SSAOBlurShader.fragmentShader\r\n\t\t} );\r\n\t\tthis.blurMaterial.uniforms[ 'tDiffuse' ].value = this.ssaoRenderTarget.texture;\r\n\t\tthis.blurMaterial.uniforms[ 'resolution' ].value.set( this.width, this.height );\r\n\r\n\t\t// material for rendering the depth\r\n\r\n\t\tthis.depthRenderMaterial = new ShaderMaterial( {\r\n\t\t\tdefines: Object.assign( {}, SSAODepthShader.defines ),\r\n\t\t\tuniforms: UniformsUtils.clone( SSAODepthShader.uniforms ),\r\n\t\t\tvertexShader: SSAODepthShader.vertexShader,\r\n\t\t\tfragmentShader: SSAODepthShader.fragmentShader,\r\n\t\t\tblending: NoBlending\r\n\t\t} );\r\n\t\tthis.depthRenderMaterial.uniforms[ 'tDepth' ].value = this.normalRenderTarget.depthTexture;\r\n\t\tthis.depthRenderMaterial.uniforms[ 'cameraNear' ].value = this.camera.near;\r\n\t\tthis.depthRenderMaterial.uniforms[ 'cameraFar' ].value = this.camera.far;\r\n\r\n\t\t// material for rendering the content of a render target\r\n\r\n\t\tthis.copyMaterial = new ShaderMaterial( {\r\n\t\t\tuniforms: UniformsUtils.clone( CopyShader.uniforms ),\r\n\t\t\tvertexShader: CopyShader.vertexShader,\r\n\t\t\tfragmentShader: CopyShader.fragmentShader,\r\n\t\t\ttransparent: true,\r\n\t\t\tdepthTest: false,\r\n\t\t\tdepthWrite: false,\r\n\t\t\tblendSrc: DstColorFactor,\r\n\t\t\tblendDst: ZeroFactor,\r\n\t\t\tblendEquation: AddEquation,\r\n\t\t\tblendSrcAlpha: DstAlphaFactor,\r\n\t\t\tblendDstAlpha: ZeroFactor,\r\n\t\t\tblendEquationAlpha: AddEquation\r\n\t\t} );\r\n\r\n\t\tthis.fsQuad = new FullScreenQuad( null );\r\n\r\n\t\tthis.originalClearColor = new Color();\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\t// dispose render targets\r\n\r\n\t\tthis.beautyRenderTarget.dispose();\r\n\t\tthis.normalRenderTarget.dispose();\r\n\t\tthis.ssaoRenderTarget.dispose();\r\n\t\tthis.blurRenderTarget.dispose();\r\n\r\n\t\t// dispose materials\r\n\r\n\t\tthis.normalMaterial.dispose();\r\n\t\tthis.blurMaterial.dispose();\r\n\t\tthis.copyMaterial.dispose();\r\n\t\tthis.depthRenderMaterial.dispose();\r\n\r\n\t\t// dipsose full screen quad\r\n\r\n\t\tthis.fsQuad.dispose();\r\n\r\n\t}\r\n\r\n\trender( renderer, writeBuffer /*, readBuffer, deltaTime, maskActive */ ) {\r\n\r\n\t\tif ( renderer.capabilities.isWebGL2 === false ) this.noiseTexture.format = LuminanceFormat;\r\n\r\n\t\t// render beauty\r\n\r\n\t\trenderer.setRenderTarget( this.beautyRenderTarget );\r\n\t\trenderer.clear();\r\n\t\trenderer.render( this.scene, this.camera );\r\n\r\n\t\t// render normals and depth (honor only meshes, points and lines do not contribute to SSAO)\r\n\r\n\t\tthis.overrideVisibility();\r\n\t\tthis.renderOverride( renderer, this.normalMaterial, this.normalRenderTarget, 0x7777ff, 1.0 );\r\n\t\tthis.restoreVisibility();\r\n\r\n\t\t// render SSAO\r\n\r\n\t\tthis.ssaoMaterial.uniforms[ 'kernelRadius' ].value = this.kernelRadius;\r\n\t\tthis.ssaoMaterial.uniforms[ 'minDistance' ].value = this.minDistance;\r\n\t\tthis.ssaoMaterial.uniforms[ 'maxDistance' ].value = this.maxDistance;\r\n\t\tthis.renderPass( renderer, this.ssaoMaterial, this.ssaoRenderTarget );\r\n\r\n\t\t// render blur\r\n\r\n\t\tthis.renderPass( renderer, this.blurMaterial, this.blurRenderTarget );\r\n\r\n\t\t// output result to screen\r\n\r\n\t\tswitch ( this.output ) {\r\n\r\n\t\t\tcase SSAOPass.OUTPUT.SSAO:\r\n\r\n\t\t\t\tthis.copyMaterial.uniforms[ 'tDiffuse' ].value = this.ssaoRenderTarget.texture;\r\n\t\t\t\tthis.copyMaterial.blending = NoBlending;\r\n\t\t\t\tthis.renderPass( renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase SSAOPass.OUTPUT.Blur:\r\n\r\n\t\t\t\tthis.copyMaterial.uniforms[ 'tDiffuse' ].value = this.blurRenderTarget.texture;\r\n\t\t\t\tthis.copyMaterial.blending = NoBlending;\r\n\t\t\t\tthis.renderPass( renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase SSAOPass.OUTPUT.Beauty:\r\n\r\n\t\t\t\tthis.copyMaterial.uniforms[ 'tDiffuse' ].value = this.beautyRenderTarget.texture;\r\n\t\t\t\tthis.copyMaterial.blending = NoBlending;\r\n\t\t\t\tthis.renderPass( renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase SSAOPass.OUTPUT.Depth:\r\n\r\n\t\t\t\tthis.renderPass( renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase SSAOPass.OUTPUT.Normal:\r\n\r\n\t\t\t\tthis.copyMaterial.uniforms[ 'tDiffuse' ].value = this.normalRenderTarget.texture;\r\n\t\t\t\tthis.copyMaterial.blending = NoBlending;\r\n\t\t\t\tthis.renderPass( renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase SSAOPass.OUTPUT.Default:\r\n\r\n\t\t\t\tthis.copyMaterial.uniforms[ 'tDiffuse' ].value = this.beautyRenderTarget.texture;\r\n\t\t\t\tthis.copyMaterial.blending = NoBlending;\r\n\t\t\t\tthis.renderPass( renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\t\tthis.copyMaterial.uniforms[ 'tDiffuse' ].value = this.blurRenderTarget.texture;\r\n\t\t\t\tthis.copyMaterial.blending = CustomBlending;\r\n\t\t\t\tthis.renderPass( renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn( 'THREE.SSAOPass: Unknown output type.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\trenderPass( renderer, passMaterial, renderTarget, clearColor, clearAlpha ) {\r\n\r\n\t\t// save original state\r\n\t\trenderer.getClearColor( this.originalClearColor );\r\n\t\tconst originalClearAlpha = renderer.getClearAlpha();\r\n\t\tconst originalAutoClear = renderer.autoClear;\r\n\r\n\t\trenderer.setRenderTarget( renderTarget );\r\n\r\n\t\t// setup pass state\r\n\t\trenderer.autoClear = false;\r\n\t\tif ( ( clearColor !== undefined ) && ( clearColor !== null ) ) {\r\n\r\n\t\t\trenderer.setClearColor( clearColor );\r\n\t\t\trenderer.setClearAlpha( clearAlpha || 0.0 );\r\n\t\t\trenderer.clear();\r\n\r\n\t\t}\r\n\r\n\t\tthis.fsQuad.material = passMaterial;\r\n\t\tthis.fsQuad.render( renderer );\r\n\r\n\t\t// restore original state\r\n\t\trenderer.autoClear = originalAutoClear;\r\n\t\trenderer.setClearColor( this.originalClearColor );\r\n\t\trenderer.setClearAlpha( originalClearAlpha );\r\n\r\n\t}\r\n\r\n\trenderOverride( renderer, overrideMaterial, renderTarget, clearColor, clearAlpha ) {\r\n\r\n\t\trenderer.getClearColor( this.originalClearColor );\r\n\t\tconst originalClearAlpha = renderer.getClearAlpha();\r\n\t\tconst originalAutoClear = renderer.autoClear;\r\n\r\n\t\trenderer.setRenderTarget( renderTarget );\r\n\t\trenderer.autoClear = false;\r\n\r\n\t\tclearColor = overrideMaterial.clearColor || clearColor;\r\n\t\tclearAlpha = overrideMaterial.clearAlpha || clearAlpha;\r\n\r\n\t\tif ( ( clearColor !== undefined ) && ( clearColor !== null ) ) {\r\n\r\n\t\t\trenderer.setClearColor( clearColor );\r\n\t\t\trenderer.setClearAlpha( clearAlpha || 0.0 );\r\n\t\t\trenderer.clear();\r\n\r\n\t\t}\r\n\r\n\t\tthis.scene.overrideMaterial = overrideMaterial;\r\n\t\trenderer.render( this.scene, this.camera );\r\n\t\tthis.scene.overrideMaterial = null;\r\n\r\n\t\t// restore original state\r\n\r\n\t\trenderer.autoClear = originalAutoClear;\r\n\t\trenderer.setClearColor( this.originalClearColor );\r\n\t\trenderer.setClearAlpha( originalClearAlpha );\r\n\r\n\t}\r\n\r\n\tsetSize( width, height ) {\r\n\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\r\n\t\tthis.beautyRenderTarget.setSize( width, height );\r\n\t\tthis.ssaoRenderTarget.setSize( width, height );\r\n\t\tthis.normalRenderTarget.setSize( width, height );\r\n\t\tthis.blurRenderTarget.setSize( width, height );\r\n\r\n\t\tthis.ssaoMaterial.uniforms[ 'resolution' ].value.set( width, height );\r\n\t\tthis.ssaoMaterial.uniforms[ 'cameraProjectionMatrix' ].value.copy( this.camera.projectionMatrix );\r\n\t\tthis.ssaoMaterial.uniforms[ 'cameraInverseProjectionMatrix' ].value.copy( this.camera.projectionMatrixInverse );\r\n\r\n\t\tthis.blurMaterial.uniforms[ 'resolution' ].value.set( width, height );\r\n\r\n\t}\r\n\r\n\tgenerateSampleKernel() {\r\n\r\n\t\tconst kernelSize = this.kernelSize;\r\n\t\tconst kernel = this.kernel;\r\n\r\n\t\tfor ( let i = 0; i < kernelSize; i ++ ) {\r\n\r\n\t\t\tconst sample = new Vector3();\r\n\t\t\tsample.x = ( Math.random() * 2 ) - 1;\r\n\t\t\tsample.y = ( Math.random() * 2 ) - 1;\r\n\t\t\tsample.z = Math.random();\r\n\r\n\t\t\tsample.normalize();\r\n\r\n\t\t\tlet scale = i / kernelSize;\r\n\t\t\tscale = MathUtils.lerp( 0.1, 1, scale * scale );\r\n\t\t\tsample.multiplyScalar( scale );\r\n\r\n\t\t\tkernel.push( sample );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgenerateRandomKernelRotations() {\r\n\r\n\t\tconst width = 4, height = 4;\r\n\r\n\t\tconst simplex = new SimplexNoise();\r\n\r\n\t\tconst size = width * height;\r\n\t\tconst data = new Float32Array( size );\r\n\r\n\t\tfor ( let i = 0; i < size; i ++ ) {\r\n\r\n\t\t\tconst x = ( Math.random() * 2 ) - 1;\r\n\t\t\tconst y = ( Math.random() * 2 ) - 1;\r\n\t\t\tconst z = 0;\r\n\r\n\t\t\tdata[ i ] = simplex.noise3d( x, y, z );\r\n\r\n\t\t}\r\n\r\n\t\tthis.noiseTexture = new DataTexture( data, width, height, RedFormat, FloatType );\r\n\t\tthis.noiseTexture.wrapS = RepeatWrapping;\r\n\t\tthis.noiseTexture.wrapT = RepeatWrapping;\r\n\t\tthis.noiseTexture.needsUpdate = true;\r\n\r\n\t}\r\n\r\n\toverrideVisibility() {\r\n\r\n\t\tconst scene = this.scene;\r\n\t\tconst cache = this._visibilityCache;\r\n\r\n\t\tscene.traverse( function ( object ) {\r\n\r\n\t\t\tcache.set( object, object.visible );\r\n\r\n\t\t\tif ( object.isPoints || object.isLine ) object.visible = false;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\trestoreVisibility() {\r\n\r\n\t\tconst scene = this.scene;\r\n\t\tconst cache = this._visibilityCache;\r\n\r\n\t\tscene.traverse( function ( object ) {\r\n\r\n\t\t\tconst visible = cache.get( object );\r\n\t\t\tobject.visible = visible;\r\n\r\n\t\t} );\r\n\r\n\t\tcache.clear();\r\n\r\n\t}\r\n\r\n}\r\n\r\nSSAOPass.OUTPUT = {\r\n\t'Default': 0,\r\n\t'SSAO': 1,\r\n\t'Blur': 2,\r\n\t'Beauty': 3,\r\n\t'Depth': 4,\r\n\t'Normal': 5\r\n};\r\n\r\nexport { SSAOPass };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}